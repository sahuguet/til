---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const allTils = await getCollection('tils', ({ data }) => {
  return data.publish === true;
});

// Sort by date, newest first
const sortedTils = allTils.sort((a, b) => {
  return b.data.date.getTime() - a.data.date.getTime();
});
---

<Layout title="TIL - Today I Learned">
  <h1>Today I Learned</h1>
  <p>Short snippets of things I learn.</p>

  <div style="margin-top: 2rem;">
    {sortedTils.length === 0 ? (
      <p>No TILs published yet.</p>
    ) : (
      <ul style="list-style: none; padding: 0;">
        {sortedTils.map((til) => (
          <li style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--color-border);">
            <h2 style="margin: 0;">
              <a href={`/til/${til.slug}/`}>{til.data.title}</a>
            </h2>
            <time style="color: #666; font-size: 0.9rem;">
              {til.data.date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </time>
            {til.data.tags && til.data.tags.length > 0 && (
              <div style="margin-top: 0.5rem;">
                {til.data.tags.map((tag) => (
                  <span style="background: var(--color-code-bg); padding: 0.2rem 0.5rem; margin-right: 0.5rem; border-radius: 3px; font-size: 0.85rem;">
                    #{tag}
                  </span>
                ))}
              </div>
            )}
          </li>
        ))}
      </ul>
    )}
  </div>
</Layout>
